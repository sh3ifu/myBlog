<!DOCTYPE html>
<html>
<head>
    <title>CaramelSwap - My DEX(Uniswap v1.0)</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@200&family=Source+Sans+Pro:wght@200;300&display=swap" rel="stylesheet">

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <div class="main-block">
        <h2 id="title">CaramelSwap - My DEX(Uniswap v1.0)</h2>
        <hr>
        <div class="under-hr-info">
            <span id="date">2024 April 06</span>
            <a id="all-posts" href="../blockchain.html">See all posts</a>
        </div>

        <div class="text">
          <blockquote>
            <p><i>P.S. Ця стаття відрізняється від інших моїх статтей, оскільки вона заснована на моїй дипломній роботі. Тому тут буде розповідатись не просто теорія, а і те як це було реалізовано в мому проекті. Розробляючи свій проект я надихався Uniswap, конкретно версією v1, оскільки з самого початку в мене не було знань в цій області, я вирішив вивчати цю тему послідовно.</i></p>
          </blockquote>

          <p>Технологія блокчейн та криптовалюти стали невід'ємною частиною сучасного фінансового світу, переусвідомлюючи традиційні фінансові системи та методи обміну активами. Одним із ключових інноваційних проявів цього прогресу є децентралізовані біржі (DEX) та фінансові протоколи, які надають користувачам безпрецедентні можливості в сфері обміну та торгівлі цифровими валютами.</p>
          <p>На відміну від централізованих бірж, DEX функціонують на основі смарт-контрактів, забезпечуючи прямий обмін активами між учасниками мережі без посередників. Це усуває потребу в довірених третіх сторонах, таких як банки чи фінансові установи, що значно підвищує швидкість, ефективність та надійність торгівлі.</p>
          <p>DEX прагнуть надати користувачам повний контроль над власними активами та сприяти вільному та прозорому обміну цінностями в глобальному масштабі. У цій статті ми заглибимося в принципи роботи DEX, розглянемо їх переваги та недоліки, а також дослідимо технології та алгоритми, що лежать в основі їх функціонування.</p>

          <h2>Теорія</h2>          
          <h3>Принципи функціонування децентралізованих бірж</h3>
          <p><a href="https://cointelegraph.com/learn/what-are-decentralized-exchanges-and-how-do-dexs-work">Децентралізовані біржі(DEX)</a> є інноваційними фінансовими платформами, які дозволяють обмінювати цифрові активи без посередників та контролю централізованих організацій. Вони працюють на базі блокчейну, забезпечуючи безпеку, прозорість та незалежність у фінансових операціях.</p>
          <p>Одним з ключових принципів DEX є відсутність посередників. Традиційні централізовані біржі залежать від посередницьких установ, таких як банки або фінансові організації, які контролюють операції обміну активами. У децентралізованих біржах, за допомогою <a href="https://www.investopedia.com/terms/s/smart-contracts.asp">смарт-контрактів</a>, операції здійснюються безпосередньо між учасниками, уникаючи посередницької ролі. Це сприяє швидкості, ефективності та виключає ризик зловживання або неправомірних дій зі сторони посередників.</p>
          <p>Інший важливий принцип DEX - це контроль над власними активами. На традиційних централізованих біржах, учасники змушені довіряти свої активи посереднику, який зберігає їх на централізованих рахунках. У децентралізованих біржах, кожен учасник має повний контроль над своїми активами. Смарт-контракти забезпечують безпечне зберігання та обмін активами, уникаючи ризику втрати або несанкціонованого доступу до них.</p>
          <p>Отже існує кілька ключових принципів, які лежать в основі дизайну DEX. Ці принципи включають:</p>
          <ul>            
            <li><b>Децентралізація:</b> децентралізація означає, що DEX не контролюються жодною окремою організацією. Це робить їх більш стійкими до цензури та маніпуляцій.</li>
            <li><b>Ефективність:</b> блокчейн, на якому базуються децентралізовані біржі, є публічним реєстром, доступним для перегляду всіма учасниками. Це означає, що всі операції, транзакції та баланси активів є доступними для перевірки та перегляду. Ця властивість забезпечує високий рівень довіри серед учасників та підвищує прозорість у фінансових операціях.</li>
            <li><b>Безпека:</b> DEX використовують смарт-контракти для здійснення транзакцій, які є самодостатніми контрактами, що зберігаються в блокчейні. Це усуває необхідність для третьої сторони зберігати кошти користувачів, що робить DEX більш безпечними.</li>
            <li><b>Ефективність:</b> DEX можуть бути більш ефективними, ніж централізовані біржі, оскільки їм не потрібна третя сторона для сприяння торгівлі. Це може призвести до нижчих комісій та швидшого проведення транзакцій.</li>
          </ul>
          <p>Також, однією з головних переваг DEX є можливість обміну активами без географічних обмежень. Традиційні біржі часто обмежують доступ до своїх послуг в залежності від місцезнаходження учасників. Децентралізовані біржі вирішують цю проблему, дозволяючи учасникам з усього світу обмінюватись активами без обмежень і перешкод.</p>
          <p>Отже, принцип функціонування децентралізованих бірж (DEX) демонструє, що вони представляють собою перспективну альтернативу традиційним централізованим біржам. Враховуючи переваги, такі як відсутність посередників, контроль над активами, прозорість операцій та географічні безмежності, DEX відкриває нові можливості для обміну цифровими активами. Розуміння цих принципів є необхідним для подальшої розробки смарт-контрактів для децентралізованих бірж, які забезпечують безпеку та надійність у фінансових операціях на блокчейні <a href="https://ethereum.org/en/developers/docs/intro-to-ethereum/">Ethereum</a>.</p>
          
          <h3>Переваги та недоліки DEX порівняно з централізованими біржами</h3>
          <p>Децентралізовані біржі (DEX) та централізовані біржі мають свої переваги та недоліки.</p>
          <h4>Переваги децентралізованих бірж (DEX):</h4>
          <ul>
            <li><b>Відсутність посередників:</b> DEX дозволяє учасникам обмінюватись активами без посередницьких організацій, таких як банки або брокери. Це забезпечує більшу автономію, безпеку та контроль над активами, оскільки учасники мають прямий доступ до своїх цифрових активів.</li>
            <li><b>Прозорість:</b> операції на DEX здійснюються на <a href="https://www.ledger.com/academy/glossary/public-blockchain">публічному блокчейні</a>, що забезпечує високий рівень прозорості. Усі транзакції та баланси активів є доступними для перевірки та перегляду усіма учасниками мережі. Це сприяє відкритості та довірі серед учасників ринку.</li>
            <li><b>Безпека:</b> DEX має вищий рівень безпеки порівняно з централізованими біржами, оскільки він не має єдиного центрального пункту вразливості. Кожна транзакція підтверджується мережею блокчейну та виконується за допомогою смарт-контрактів, що забезпечує недоступність для шахраїв та зловмисників.</li>
            <li><b>Географічна безмежність:</b> DEX дозволяє учасникам з усього світу обмінюватись активами без обмежень і перешкод. Це створює можливість для глобального фінансового взаємозв'язку та розвитку міжнародної торгівлі.</li>
          </ul>
          <h4>Недоліки децентралізованих бірж (DEX):</h4>
          <ul>
            <li><b>Обмежена ліквідність:</b> у порівнянні з централізованими біржами, DEX можуть мати обмежену <a href="https://www.financemagnates.com/terms/l/liquidity/">ліквідність</a>, оскільки торгівля здійснюється між безпосередніми учасниками мережі. Це може призвести до більшої волатильності цін та меншої доступності активів.</li>
            <li><b>Швидкість транзакцій:</b> залежно від блокчейну, на якому базується DEX, швидкість транзакцій може бути обмеженою. Блокчейн Ethereum, наприклад, має обмежену пропускну здатність, що може призвести до затримок у виконанні та підтвердженні транзакцій.</li>
            <li><b>Відповідальність за безпеку:</b> учасники DEX самостійно несуть відповідальність за безпеку своїх активів. Вони повинні бути обережними при використанні своїх приватних ключів та забезпечити відсутність доступу зловмисників до своїх цифрових гаманців.</li>
            <li><b>Обмежені функціональність та інтерфейс:</b> деякі DEX можуть мати обмежені функціональні можливості порівняно з централізованими біржами, такі як відсутність інструментів технічного аналізу чи обмежена підтримка різних типів ордерів. Крім того, інтерфейс користувача DEX може бути складнішим для новачків у світі криптовалют.</li>
          </ul>
          <img src="https://www.dropbox.com/scl/fi/a14p5vgln14r8bvi60u0p/blockchain-2024-06-04_01.png?rlkey=7go8r9p62f2aqopcoamloj0cd&dl=1" width="900" class="one_picture"></img>
          <p class="one_caption">Рис. 1 Порівняння DEX і централізованих бірж</p>
          <p>Загалом, DEX пропонують багато переваг, таких як відсутність посередників, прозорість та безпека. Однак, вони також мають свої недоліки, зокрема обмежену ліквідність та можливість швидкісних обмежень. Вибір між DEX та централізованими біржами залежить від конкретних потреб та ризиків кожного учасника ринку.</p>

          <h3>Стандарти токенів ERC-20 та ERC-721 для представлення цифрових активів</h3>          
          <p>Стандарти токенів <a href="https://ethereum.org/en/developers/docs/standards/tokens/erc-20/">ERC-20</a> та <a href="https://ethereum.org/en/developers/docs/standards/tokens/erc-721/">ERC-721</a> відіграють важливу роль в екосистемі блокчейну Ethereum, де вони використовуються для представлення та обміну цифрових активів. Кожен з цих стандартів має свої особливості та застосування, що сприяє розширенню можливостей децентралізованих фінансових та некерованих активів.</p>
          <p>Стандарт ERC-20 (Ethereum Request for Comment 20) є найпоширенішим стандартом для токенів на базі блокчейну Ethereum. Цей стандарт встановлює правила та функції, які повинен відповідати токен, що його випускає. ERC-20 токени є однорідними та взаємозамінними, що означає, що кожен токен одного типу може бути замінений на будь-який інший токен того ж типу без втрати цінності. Це робить ERC-20 токени ідеальними для використання в додатках, фінансових інструментах та розподілених системах голосування.</p>
          <p>Зараз підтримка стандарту ERC-20 є широкою серед різноманітних криптовалют та токенів на базі Ethereum. Він дозволяє зручний обмін та взаємодію з цифровими активами, що прискорює розвиток економіки децентралізованих фінансових послуг.</p>
          <p>Токени можуть представляти практично все, що завгодно в Ethereum:</p>
          <ul>
            <li>бали репутації на онлайн-платформі</li>
            <li>навички персонажа в грі</li>
            <li>лотерейні квитки</li>
            <li>фінансові активи, такі як частка в компанії</li>
            <li>фіатну валюту, наприклад, долар США</li>
            <li>унція золота</li>
          </ul>
          <p>Приклади функцій, які надає ERC-20:</p>
          <ul>
            <li>переказувати токени з одного рахунку на інший</li>
            <li>отримати поточний баланс токенів на рахунку</li>
            <li>отримати загальний запас токенів, доступних в мережі</li>
            <li>підтверджувати, чи може певна кількість токенів з рахунку бути витрачена на рахунок третьої сторони</li>
          </ul>
          <p>Методи стандарту ERC-20</p>
          <div class="iframe_center">
            <iframe src="https://ethfiddle.com/services/iframesnippet/9k5mrhgzuG" scrolling="no" frameborder="0" height="455" width="300" style="width: 60%;"></iframe>
          </div>
          <p>Якщо смарт-контракт реалізує перераховані нижче методи і події, його можна назвати ERC-20 Token Contract, і після розгортання він буде відповідати за відстеження створених токенів в мережі Ethereum.</p>
          <p>З іншого боку, стандарт ERC-721 (Ethereum Request for Comment 721) представляє неінтерфейсний стандарт токена на блокчейні Ethereum. Цей стандарт використовується для випуску унікальних та неповторних токенів, відомих як некеровані токени. Кожен ERC-721 токен має свою власну ідентифікаційну мітку, що робить його унікальним серед інших токенів. Це дозволяє представляти різноманітні активи, такі як мистецтво, нерухомість, геймінгові предмети тощо, у вигляді цифрових токенів з гарантованою унікальністю.</p>
          <p>Стандарт ERC-721 надає широкі можливості для створення цифрових колекцій, грифікації та створення унікальних інтерактивних додатків. Він використовується в ігровій індустрії для створення неповторних предметів у гральних проектах та в інших сферах, де важлива унікальність активу.</p>
          <p>Він надає такі функції, як переказ токенів з одного облікового запису на інший, отримання поточного балансу токенів на рахунку, отримання інформації про власника конкретного токена, а також про загальну пропозицію токенів, доступних в мережі. Крім того, він також має деякі інші функції, такі як підтвердження того, що певна кількість токенів з рахунку може бути переміщена на рахунок третьої сторони.</p>
          <div class="iframe_center">
            <iframe src="https://ethfiddle.com/services/iframesnippet/Cwjb7sqlVa" scrolling="no" frameborder="0" height="350" width="300" style="width: 60%;"></iframe>
          </div>
          <p>Якщо смарт-контракт реалізує наступні методи і події, його можна назвати ERC-721 Non-Fungible Token Contract і, після розгортання, він буде відповідати за відстеження створених токенів в Ethereum.</p>
          <p>Переваги стандартів ERC-20 та ERC-721 полягають у створенні стандартизованого та сумісного середовища для розробки та використання цифрових активів на базі блокчейну Ethereum. Це сприяє зручній взаємодії та обміну активами, а також створює основу для розвитку нових інноваційних додатків та послуг.</p>
          <p>Недоліки стандартів ERC-20 та ERC-721 пов'язані з їх обмеженнями. Наприклад, стандарт ERC-20 не передбачає можливість виконання окремих дій при обміні токенів, що може призвести до проблем з безпекою та незручностями в окремих випадках використання. Щодо стандарту ERC-721, він має більш складну структуру та вимагає більш ресурсоємких операцій для обробки транзакцій, що може вплинути на швидкість та масштабованість додатків, що використовують цей стандарт.</p>
          <img src="https://www.dropbox.com/scl/fi/5aa8mr9xe2mxhkb9h7ed6/blockchain-2024-06-04_02.png?rlkey=6o4yuyelg04aqfhunz3rd0vzo&dl=1" width="900" class="one_picture"></img>
          <p class="one_caption">Рис. 2 Відмінність взаємозамінних(ERC-20) від невзаємозамінних (ERC-721) токенів</p>
          <p>Усупереч своїм недолікам, стандарти ERC-20 та ERC-721 є ключовими компонентами блокчейну Ethereum, що сприяють розширенню можливостей децентралізованих фінансових послуг, цифрової власності та інших іноваційних рішень. Їх використання вже дозволило створити широкий спектр проектів, що використовують блокчейн Ethereum, і можна очікувати подальшого розвитку цих стандартів та їх впливу на глобальну економіку та технологічну індустрію.</p>

          <h3>Модель автоматичного ринкового мейкера</h3>
          <p><b>Автоматичний ринковий мейкер</b> - це алгоритмічна торгівельна стратегія, яка забезпечує ліквідність та підтримує процес обміну криптоактивами на DEX. Основна мета ринкового мейкера полягає в тому, щоб завжди мати готові до виконання угоди котирування для покупців та продавців на ринку.</p>
          <p>У моделі автоматичного ринкового мейкера використовуються різні алгоритми та стратегії, які оптимально визначають ціни для активів на основі різних факторів, таких як ліквідність, попит та пропозиція, волатильність ринку тощо. Ринковий мейкер постійно аналізує цінову динаміку та інші ринкові показники для актуалізації котирувань та адаптації до змін у ринкових умовах.</p>
          <p>Ринковий мейкер виступає як посередник між покупцями та продавцями, створюючи ліквідність на біржі шляхом постійного надання готових до виконання угоди котирувань для різних торгівельних пар. Дослідження охоплює вивчення різних алгоритмів та стратегій, які використовуються в автоматичних ринкових мейкерах для оптимального ціноутворення та забезпечення ефективного обміну активами.</p>
          <img src="https://www.dropbox.com/scl/fi/2sc84drnda6viopc9mu4y/blockchain-2024-06-04_03.png?rlkey=iy3ey7xvtur3qqtzhnp0plbmd&dl=1" width="1000" class="one_picture"></img>
          <p class="one_caption">Рис. 3 Принцип роботи ринкового мейкера Uniswap</p>
          <p>Крім того, аналіз моделі автоматичного ринкового мейкера включає розгляд механізмів контролю ризиків та оптимізації торгівельних стратегій. З метою забезпечення стійкості та безпеки ринкового мейкера, необхідно провести дослідження щодо виявлення та управління можливими ризиками, такими як висока волатильність ринку, непередбачуваність угод та можливість зламу алгоритмів. Крім того, необхідно дослідити можливості використання статистичних та математичних моделей для покращення торгівельних стратегій ринкового мейкера.</p>
          <p>Окрім того, модель автоматичного ринкового мейкера забезпечує зниження спредів на ринку. <b>Спред</b> - це різниця між купівельною та продажною ціною активу. Ринковий мейкер створює котирування, які наближають купівельну та продажну ціну, тим самим зменшуючи спред та забезпечуючи більш вигідні умови для учасників ринку.</p>
          <p>Однак, модель автоматичного ринкового мейкера також має свої недоліки. Наприклад, вона може стикатись з ризиками волатильності ринку та недостатньою ліквідністю під час швидких змін цінових показників. Також, неправильно налаштована стратегія ринкового мейкера може призвести до неефективних котирувань та можливих фінансових втрат.</p>
          <img src="https://www.dropbox.com/scl/fi/vpg7j1sx0n3qnbh6w9uub/blockchain-2024-06-04_04.png?rlkey=17kienasbyf5b34znr3ti6w6d&dl=1" width="1000" class="one_picture"></img>
          <p class="one_caption">Рис. 4 Принцип роботи автоматичного ринкового мейкера на прикладі зі «стейблкоінами»</p>
          <p>У процесі дослідження моделі автоматичного ринкового мейкера також важливо вивчити роль та вплив різних факторів, таких як ліквідність ринку, торгівельний обсяг, спреди, комісії та інші параметри, на ефективність та результативність ринкового мейкера. Це дозволить визначити оптимальні параметри та стратегії для забезпечення успішної роботи автоматичного ринкового мейкера на децентралізованій біржі.</p>
          <p>Загальною метою вивчення моделі автоматичного ринкового мейкера є розробка ефективного та надійного алгоритму ринкового мейкера для децентралізованої біржі. Цей алгоритм повинен забезпечувати покупців та продавців достатньою ліквідністю для здійснення угод та ефективно оптимізувати ціноутворення. Вивчення моделі автоматичного ринкового мейкера є ключовим етапом у розробці та впровадженні децентралізованих бірж, які мають потенціал перевернути традиційну фінансову систему та забезпечити більш ефективні та прозорі умови торгівлі активами.</p>

          <h3>Що таке пули ліквідності</h3>
          <p>Пул ліквідності (<a href="https://www.coindesk.com/learn/what-are-liquidity-pools/">liquidity pool</a>) є важливою складовою децентралізованих бірж (DEX) та інших фінансових протоколів, що базуються на блокчейні. Він використовується для забезпечення ліквідності та виконання торговельних операцій з цифровими активами. Тобто в основі AMM лежать пули ліквідності - краудсорсингова колекція криптоактивів, які AMM використовує для торгівлі з людьми, що купують або продають один з цих активів. Користувачі, які вносять свої активи в пули, відомі як постачальники ліквідності (LP).</p>
          <p>Ліквідність необхідна для належного функціонування AMM. Якщо AMM не має достатнього пулу ліквідності, це може спричинити значний вплив на ціну, коли трейдери купують і продають активи на DeFi AMM, що призводить до неефективного використання капіталу та непостійних збитків. Щоб стимулювати постачальників ліквідності вносити свої криптоактиви в протокол, AMM винагороджують їх частиною комісійних, що генеруються на AMM, які зазвичай розподіляються у вигляді токенів LP. Практика депонування активів для отримання винагороди відома під назвою <a href="https://www.coindesk.com/learn/yield-farming-what-is-it-and-how-does-it-work/">yield farming</a></p>
          <p>Пул ліквідності зазвичай працює на основі "розумних контрактів" (smart contracts), які автоматично виконують логіку обміну активами між учасниками. Учасники пулу можуть робити ставки на курс обміну та додавати або знімати свої активи з пулу. При виконанні торгівельних операцій, розумні контракти автоматично вираховують курс обміну на основі пропорцій внесених активів і виконують обмін.</p>
          <img src="https://www.dropbox.com/scl/fi/1gmxga0wpp6fbzhqx4fkw/blockchain-2024-06-04_05.png?rlkey=mcudwa0oijmopm0y4qpza6qei&dl=1" width="1000" class="one_picture"></img>
          <p class="one_caption">Рис. 5 Приклад пула ліквідності платформи Uniswap</p>
          <p>Пули ліквідності дозволяють створювати більш ліквідні ринки для цифрових активів. Вони забезпечують постійну наявність ліквідності для торгівлі та знижують спред між купівельною та продажною ціною активу. Чим більший обсяг ліквідності в пулі, тим менші впливи на ціну мають великі операції купівлі-продажу.</p>
          <p>Ціни на активи на AMM автоматично змінюються залежно від попиту. Наприклад, пул ліквідності може містити десять мільйонів доларів в ETH і десять мільйонів доларів в USDC. Трейдер може обміняти 500 тисяч доларів USDC на ETH, що підвищить ціну ETH на AMM.</p>
          <p>Принцип роботи пулів ліквідності базується на концепції автоматичного ринкового мейкера, де розумні контракти автоматично вирівнюють курс обміну і забезпечують ліквідність для торговельних операцій. Учасники пулу отримують винагороду за надання ліквідності від комісій, що сплачуються під час торговельних операцій.</p>
          <p>В дослідженні, проведеному в рамках даної роботи, буде розроблено смарт-контракт пулу ліквідності для децентралізованої біржі на базі блокчейну Ethereum. Цей смарт-контракт дозволить користувачам додавати та знімати ліквідність, отримувати винагороду та здійснювати торговельні операції з цифровими активами на біржі.</p>

          <h3>Види автоматичних ринкових мейкерів</h3>
          <p>Маркет-мейкери з постійною функцією (CFMM), такі як маркет-мейкери з постійним продуктом, маркет-мейкери з постійною сумою та маркет-мейкери з постійним середнім значенням, - це клас AMM першого покоління, який став популярним завдяки таким протоколам, як <a href="https://bancor.network/">Bancor</a>, <a href="https://curve.fi/">Curve</a> та <a href="https://uniswap.org/">Uniswap</a>. Ці AMM-обміни базуються на постійній функції, де сукупні резерви активів торгових пар повинні залишатися незмінними. У некастодіальних AMM депозити користувачів для торгових пар об'єднуються в рамках смарт-контракту, який будь-який трейдер може використовувати для забезпечення ліквідності токен-свопів. Користувачі торгують проти смарт-контракту (об'єднаних активів), а не безпосередньо з контрагентом, як на біржах з книгами замовлень.</p>

          <h4>Постійний маркет-мейкер продукту (CPMM)</h4>
          <p>Першим типом CFMM став постійний маркет-мейкер продукту (CPMM), який був популяризований першою DEX на основі AMM, Bancor. В основі CPMM лежить функція \( x \times y = k \), яка встановлює діапазон цін на два токени відповідно до наявної кількості (ліквідності) кожного токена. Коли пропозиція токенів <i>X</i> збільшується, пропозиція токенів <i>Y</i> повинна зменшуватися, і навпаки, щоб підтримувати постійний добуток <i>K</i>. При побудові графіку результатом є гіпербола, де ліквідність завжди доступна, але за дедалі вищими цінами, які наближаються до нескінченності на обох кінцях.</p>
          <img src="https://www.dropbox.com/scl/fi/ndaystuvtf3u2l2nvgsde/blockchain-2024-06-04_06.png?rlkey=3hoa3acl2b31koxxop512u5ue&dl=1" width="450" class="one_picture"></img>
          <p class="one_caption">Рис. 6 Візуалізація константного ринкового мейкера з постійним добутком</p>

          <h4>Маркет-мейкер з постійною сумою (CSMM)</h4>
          <p>Другий тип - маркет-мейкер з постійною сумою (CSMM), який ідеально підходить для угод з нульовим впливом на ціну, <u>але не забезпечує нескінченну ліквідність</u>. CSMM працюють за формулою \( x + y = k \), яка створює пряму лінію на графіку. На жаль, така конструкція дозволяє арбітражникам "злити" один з резервів, якщо позамережева ціна між токенами не дорівнює 1:1. Така ситуація руйнує одну сторону пулу ліквідності, залишаючи всю ліквідність лише в одному з активів і, таким чином, не залишаючи більше ліквідності для трейдерів. Через це CSMM є моделлю, яка рідко використовується AMM.</p>
          <img src="https://www.dropbox.com/scl/fi/6czptdlgcdxw2kez5jqk1/blockchain-2024-06-04_07.png?rlkey=eob7ub70y111g2kibvwigyq90&dl=1" width="450" class="one_picture"></img>
          <p class="one_caption">Рис. 7 Маркет мейкер з постійною сумою</p>

          <h4>Постійний середній маркет-мейкер (CMMM)</h4>
          <p>Третій тип - маркет-мейкер з постійним середнім значенням (CMMM), який дозволяє створювати AMM, які можуть мати більше двох токенів і зважуватися поза стандартним розподілом 50/50. У цій моделі середньозважене геометричне значення кожного резерву залишається постійним. Для пулу ліквідності з трьома активами рівняння буде наступним: \((x \cdot y \cdot z)^{\frac{1}{3}} = k\). Це дозволяє варіювати ризики за різними активами в пулі та уможливлює свопи між будь-якими активами пулу.</p>

          <h4>Гібридні CFMM</h4>
          <p>З розвитком ліквідності на основі AMM ми стали свідками появи вдосконалених гібридних CFMM, які поєднують кілька функцій і параметрів для досягнення певної поведінки, наприклад, скоригованого ризику для постачальників ліквідності або зменшення впливу на ціни для трейдерів.</p>
          <p>Наприклад, криволінійні AMM - відомі як інваріант <a href="https://medium.com/wombat-exchange/what-is-a-stableswap-58786d32e3d4"> стейблсвопу</a> - поєднують в собі як CPMM, так і CSMM, використовуючи вдосконалену формулу для створення щільніших "кишень" ліквідності, які зменшують вплив на ціну в межах певного діапазону угод. Результатом є гіпербола (синя лінія), яка повертає лінійний обмінний курс на великих ділянках цінової кривої та експоненціальні ціни, коли обмінні курси наближаються до зовнішніх меж.</p>
          <img src="https://www.dropbox.com/scl/fi/b8lvbg8pzyuhjqtquf5e4/blockchain-2024-06-04_08.png?rlkey=mnkzv38g2jkyti7ho7ckbnyw2&dl=1" width="700" class="one_picture"></img>
          <p class="one_caption">Рис. 8 Гібридний CFMM</p>
          <p>Гібридні CFMM уможливлюють торгівлю з надзвичайно низьким впливом на ціну завдяки використанню кривої обмінного курсу, яка є переважно лінійною і стає параболічною лише тоді, коли пул ліквідності вичерпується до своїх меж. Провайдери ліквідності заробляють більше комісійних (хоча й на основі нижчої комісії за угоду), оскільки капітал використовується більш ефективно, тоді як арбітражники все ще отримують прибуток від ребалансування пулу.</p>
          <p>Curve пропонує недорогі свопи між токенами, які мають відносно стабільний обмінний курс 1:1. Це означає, що його рішення переважно призначене для стейблкоінів. Однак нещодавно Curve також запустила підтримку більш волатильних пар токенів з аналогічною концентрацією ліквідності.</p>

          <h2>Алгоритми і структура проекту</h2>
          <p>Для реалізації логіки використовуються смарт контракти, які грають ключову роль у функціонуванні DEX. Основні контракти, що використовуються, включають:</p>
          <ol>
            <li><b>Контракт "Exchange":</b> цей контракт реалізує функціонал децентралізованої біржі. Він забезпечує можливість додавання та вилучення ліквідності, обмін активів та автоматичну регуляцію цін за принципом автоматичного розрахунку відношень активів на основі алгоритму AMM (Automated Market Maker).</li>
            <li><b>Контракт "Factory":</b> цей контракт відповідає за розгортання контрактів "Exchange" в блокчейні. Він генерує нові екземпляри контрактів "Exchange" для різних токенів і зберігає адреси цих контрактів для подальшого використання.</li>
            <li><b>Контракт аукціону:</b> цей контракт реалізує механізм аукціону, який дозволяє користувачам ставити ставки у власних токенах проекту, та вигравати нагороди також у токенах проекту. Головна суть цього контракту є дефляційний механізм. Він схожий на механізм англійського аукціону, де учасники можуть ставити ставки на активи та отримувати їх за найвищою запропонованою ціною.</li>
            <li><b>Контракт фабрики для аукціону:</b> цей контракт відповідає за створення нових екземплярів контракту аукціону для різних активів та зберігання адрес цих контрактів.</li>
          </ol>
          <p>Ця архітектура системи дозволяє створювати децентралізовану платформу обміну криптоактивів з автоматичною регуляцією ціни, що базується на принципах Uniswap V1 та інших подібних протоколів.</p>
          <blockquote>
            <p><i>P.S. Механізм аукціону не був реалізований в Uniswap, це вже особливість конкретно мого проекту.</i></p>
          </blockquote>

          <h3>Алгоритми</h3>
          <p>Перша блок-схема зображує алгоритм додавання активів в пул ліквідності. Спочатку йде перевірка чи є в цьому пулі якась ліквідність, якщо немає то користувач може вказати будь які значення для активу <b>x</b> та активу <b>y</b> тим самим визначивши константу <b>k</b>. Далі відбувається переведення активів з адресу користувача на адрес контракту, наступним кроком йде обрахування ліквідності в пулі, оскільки до цього в цьому пулі не було ліквідності, то змінна <b>liquidity</b> буде дорівнювати кількості ETH яке було відправлено на контракт. Далі йде нарахування(мінт) токенів ліквідності.</p>
          <img src="https://www.dropbox.com/scl/fi/qb6rsl95hcsot5v5dc5a8/blockchain-2024-06-04_09.png?rlkey=nnoqkgvuci09pm78o617jjjnr&dl=1" width="500" class="one_picture"></img>
          <p class="one_caption">Рис. 9 Блок-схема алгоритму додавання ліквідності</p>
          <p>Наступним йде алгоритм видалення ліквідності. Працює він трохи за іншим принципом – користувач передає кількість LP-токенів, які він хоче обміняти на свої активи. При вилученні ліквідності з біржі, користувач отримує назад пару криптовалют. Тобто це завжди буде ETH, а другою валютою буде якийсь ERC-20 токен, який був доданий в пул ліквідності разом з нативною монетою блокчейну.</p>
          <p>Спочатку в алгоритмі йде перевірка, чи правильну кількість токенів ліквідності передав користувач, якщо так далі йде обрахування кількості активів, які потрібно відправити користувачеві, за допомогою вищенаведенних формул, після чого викликається функція для спалювання LP-токенів і наступним кроком активи переводяться користувачеві.</p>
          <img src="https://www.dropbox.com/scl/fi/02racls13pkpq9cnojbbb/blockchain-2024-06-04_10.png?rlkey=qi9rtkify3k0u20500l2k8y9p&dl=1" class="one_picture"></img>
          <p class="one_caption">Рис. 10 Блок-схема для алгоритму видалення ліквідності</p>
          <p>Наступний алгоритм від смарт-контракту фабрики. Він використовується для створення та завантаження в блокчейн нових контрактів обміну для нових токенів. Працює він наступним чином: спочатку перевіряється коректність адресу токена(можливий варіант, що користувач хоче додати нульовий адрес), після чого йде перевірка на наявність вже існуючого контракту обміну для такого адреса токена(потрібно для того щоб не створювати багато контрактів обміну для одного і того ж токена). Далі йде виклик функції для створення нового контракту і збереження необхідних даних в змінні.</p>
          <p>Також в смарт-контракті <i>Factory</i>, є дві змінних, це: масив <i>tokenAddresses</i> типу <i>address</i>, та структура <i>mapping</i> типу <i>(address => address)</i> <i>tokenToExchange</i>. В першому масиві зберігаються всі адреси токенів, для яких були створені контракти обміну, він потрібен для того щоб потім на фронтенді можна було отримати список всіх токенів.</p>
          <p>Структура <i>tokenToExchange</i> зберігає конкретно адрес токена та адрес відповідного для нього контракту обмінника.</p>
          <img src="https://www.dropbox.com/scl/fi/hr3b186ecfnj5v2jtesh0/blockchain-2024-06-04_11.png?rlkey=zvuf2bse3sxbnfv9l8jzg9xzg&dl=1" class="one_picture"></img>
          <p class="one_caption">Рис. 11 Блок-схема до алгоритму створення нового контракту обміну</p>
          <p>Наступним йде алгоритм обміну ERC20 ↔ ERC20. Є два основних види обміну це ETH ↔ ERC20 і відповідно ERC20 ↔ ERC20. В цьому алгоритмі буде розглянуто конкретно механізм обміну токенів на токени, тому що це в собі включає також обмін токену на ефір. Механізм обміну працює наступним чином, спочатку токен1 обмінюється на ефір, потім цей ефір обмінюється на токен2.</p>
          <p>Принцип роботи механізму обміну ERC20 на ERC20:</p>
          <img src="https://www.dropbox.com/scl/fi/m4aqpuogeg0sziu9218bc/blockchain-2024-06-04_12.png?rlkey=8lhrou50hg420qkldrff1iz07&dl=1" class="one_picture"></img>
          <p class="one_caption">Рис. 12 Принцип функціонування механізму обміну ERC20 на ERC20</p>
          <p>Отже при обміні токенів на токени, спочатку по адресу другого токена, отримується адрес контракта обмінника, далі йде перевірка коректності адресу біржі, адже може бути таке, що для якогось токена біржі ще не існує, тоді повернеться нульовий адрес. Після цього йде отримання кількості токенів на контракті, розрахування скільки ETH треба заплатити за ці токени, далі переводяться токени від покупця на смарт-контракт після чого проводиться обмін.</p>
          <img src="https://www.dropbox.com/scl/fi/xdpd95j869c4putof4tkj/blockchain-2024-06-04_13.png?rlkey=6weh0ae6l2gvl8868a8jqj7pf&dl=1" class="one_picture"></img>
          <p class="one_caption">Рис. 13 Блок-схема для алгоритму обміну ERC20 на ERC20</p>
          <p>Наступним йде алгоритм для контракту аукціону. Він призначений для розміщення ставки.</p>
          <img src="https://www.dropbox.com/scl/fi/jdfa8h1yn94nfwgt41j2r/blockchain-2024-06-04_14.png?rlkey=q5bgr97wtncsg77qqkc75b9yc&dl=1" class="one_picture"></img>
          <p class="one_caption">Рис. 14 Блок-схема для алгоритму розміщення ставки на аукціоні</p>
          <p>Працює він наступним чином: спочатку йде перевірка коректності ставки – це означає, що користувач повинен зробити ставку яка за розміром більша за попередню, після цього йде перевірка на наявність такої кількості токенів у користувача. Якщо все нормально, ставка корисутвача приймається.</p>
          <p>Останнім йде алгоритм завершення аукціону. Спочатку встановлюється прапорець що засвідчує закінчення аукціону(це звичайна булева змінна), після цього викликається функція для спалювання токенів які надійшли під час ставок.</p>
          <img src="https://www.dropbox.com/scl/fi/l5ef4ou8ffbxt58n0jrwp/blockchain-2024-06-04_15.png?rlkey=13rknn100tpcze08g6zt8ju68&dl=1" class="one_picture"></img>
          <p class="one_caption">Рис. 15 Блок-схема для алгоритму завершення аукціону</p>
          <p>Далі йде перевірка коректності ставок, тому що може бути такий варіант що взагалі ніхто із користувачів не ставив, тоді і нагорода нікому не буде даватись. Якщо все нормально переможцю видаються нові токени.</p>

          <h3>Математичні моделі та методти</h3>
          <p>Один з ключових аспектів це побудова математичних моделей для опису різних процесів, які відбуваються на платформі. Наприклад моделювання процесу автоматичної регуляції ціни криптоактивів. Це включає в себе визначення вхідних параметрів, таких як попит, пропозиція, ліквідність, а також врахування факторів, що впливають на ціну. Застосування математичних моделей дозволяє прогнозувати та керувати ціновими змінами на платформі.</p>
          <p>Отже першою і основною формулою є рівняння константного ринкового мейкера(CPMM):</p>
          <p class="formula">\(x \times y = k\)</p>          
          <p>Формула свідчить, що <b>k</b> залишається постійним незалежно від того, якими є резерви (<b>x</b> і <b>y</b>). Кожна угода збільшує резерв ETH або токена і зменшує резерв токена або ETH – тоді по цій логіці, формула буде виглядати ось так:</p>
          <p class="formula">\((x + \Delta x)(y - \Delta y) = xy\)</p>
          <p>Де <b>Δx</b> - кількість ETH або токенів, які ми обмінюємо на <b>Δy</b> - кількість токенів або ETH, які ми отримуємо в обмін. Маючи цю формулу, ми можемо тепер знайти <b>Δy</b>:</p>
          <p class="formula">\(\Delta y = \frac{y\Delta x}{x+\Delta x}\)</p>
          <p>Кількість випущених токенів ліквідності визначається кількістю ETH, відправлених на функцію. Її можна розрахувати за допомогою рівняння:</p>
          <p class="formula">\(\text{amountMinted} = \text{totalAmount} \times \frac{\text{ethDeposited}}{\text{ethPool}}\)</p>
          <p>де <b>totalAmount</b> – загальна кількість активів в пулі(тобто <i>k</i>), <b>ethDeposited</b> – кількість ETH яке хоче додати користувач в пул, <b>ethPool</b> – кількість конкретно ETH в пулі.</p>
          <p>Внесення ETH в резерви вимагає також внесення еквівалентної вартості токенів ERC20. Це розраховується за допомогою рівняння:</p>
          <p class="formula">\(\text{tokensDeposited} = \text{tokenPool} \times \frac{\text{ethDeposited}}{\text{ethPool}}\)</p>
          <p>Постачальники можуть “спалити” свої токени ліквідності в будь-який час, щоб вилучити свою пропорційну частку токенів ETH і ERC20 з пулів.</p>
          <p class="formula">\(\text{ethWithdrawn} = \text{ethPool} \times \frac{\text{amountBurned}}{\text{totalAmount}}\)</p>
          <p class="formula">\(\text{tokensWithdrawn} = \text{tokenPool} \times \frac{\text{amountBurned}}{\text{totalAmount}}\)</p>
          <p>Токени ETH і ERC20 виводяться за поточним обмінним курсом (резервним коефіцієнтом), а не за коефіцієнтом початкової інвестиції. Це означає, що частина вартості може бути втрачена через ринкові коливання та арбітраж.</p>
          <p>Комісії, отримані під час торгів, додаються до загального пулу ліквідності без карбування нових токенів ліквідності. Тому <b>ethWithdrawn</b> і <b>tokensWithdrawn</b> включають пропорційну частку всіх комісій, зібраних з моменту першого додавання ліквідності.</p>

          <h2>Розробка та опис програмних модулів</h2>
          <p>Вся блокчейн архітектура складається з таких смарт-контрактів: <b>Exchange</b>, <b>Factory</b>, <b>CotteryFactory</b>, <b>Cottery</b>, <b>CaramelToken</b>.</p>
          <p>Смарт-контракти <i>Exchange</i> та <i>Factory</i> є ключовими компонентами архітектури смарт-контрактів для забезпечення ліквідності та обміну криптоактивами. Ці смарт-контракти використовуються для створення та управління торгівельними парами, обміну криптоактивами та надання ліквідності на децентралізованій біржі.</p>
          <p>Смарт-контракт <i>Factory</i> використовується для створення та управління контрактами <i>Exchange</i> для кожного окремого токена. Він зберігає адреси цих контрактів для обміну, дозволяючи веб-інтерфейсу отримувати доступ до всіх контрактів <i>Exchange</i> та викликати потрібний.</p>
          <p>Кожен смарт-контракт <i>Exchange</i>, створений за допомогою <i>Factory</i>, має можливість обмінюватись криптоактивами та додавати ліквідність до пулів. Конкретний смарт-контракт <i>Exchange</i> визначає правила обміну, переведення активів та ведення обліку операцій.</p>
          <img src="https://www.dropbox.com/scl/fi/827june8zpbtsd9ctsfh7/blockchain-2024-06-04_16.png?rlkey=mjpvm347ba4vsjvbu58u55gem&dl=1" class="one_picture"></img>
          <p class="one_caption">Рис. 16 Принцип роботи контракту Factory</p>
          <p>Більшість бірж ведуть <a href="https://www.coinbase.com/learn/advanced-trading/what-is-an-order-book">книгу замовлень</a> і полегшують збіги між покупцями і продавцями. Смарт-контракти DEX зберігають резерви ліквідності різних токенів, і угоди виконуються безпосередньо проти цих резервів. Ціни встановлюються автоматично за допомогою механізму маркет-мейкера з постійним добутком \(x \times y = k\), який підтримує загальні резерви у відносній рівновазі. Резерви об'єднуються між мережею постачальників ліквідності, які постачають системі токени в обмін на пропорційну частку комісійних за транзакції.</p>
          <p>Важливою особливістю Uniswap є використання заводського/реєстраційного контракту(<i>Factory</i>), який використовує окремий контракт обміну(<i>Exchange</i>) для кожного токена ERC20. Кожен з цих контрактів містить резерв ETH і пов'язаних з ним ERC20. Це дозволяє здійснювати торгівлю між ними на основі відносної пропозиції. Біржові контракти пов'язані через реєстр, що дозволяє здійснювати прямі операції обміну ERC20 на ERC20 між будь-якими токенами, використовуючи ETH в якості посередника.</p>
          <div class="iframe_center">
            <iframe src="https://ethfiddle.com/services/iframesnippet/TVVBZ_Wa2O" scrolling="no" frameborder="0" height="500" width="300" style="width: 50%;"></iframe>
          </div>
          <p><b>Factory.sol</b> - це смарт-контракт, який слугує одночасно і фабрикою, і реєстром для обмінів на DEX. Публічна функція <b>createExchange()</b> дозволяє будь-якому користувачеві Ethereum розгорнути контракт обміну для будь-якого ERC20, який ще не має такого контракту.</p>
          <p>Також в цьому контракті є дві додаткові функції: <b>getAllTokenAddresses</b> і <b>getExchange</b>. Перша повертає адреси всіх токенів, для яких були створені контракти обміну, а друга повертає адресу контракту обміну по адресі контракта токена.</p>
          <p>Запис всіх токенів і пов'язаних з ними бірж зберігається на фабриці. За допомогою функцій <b>getExchange()</b> і <b>getToken()</b> можна знайти токен або адресу біржі. Також за допомогою функції <b>getAllTokenAddresses()</b> можна отримати список всіх токенів.</p>
          <div class="iframe_center">
            <iframe src="https://ethfiddle.com/services/iframesnippet/_-dgSGgeVE" scrolling="no" frameborder="0" height="300" width="300" style="width: 50%;"></iframe>
          </div>
          <p>Фабрика не виконує жодних перевірок токенів під час запуску контракту на обмін, окрім перевірки дотримання ліміту "один обмін на токен" і перевірки адресу самого токену. Користувачі і фронтенди повинні взаємодіяти тільки з тими біржами, які пов'язані з токенами, яким вони довіряють.</p>

          <h3>Обмін ETH ⇄ ERC20</h3>
          <p>Кожен контракт обміну (<i>Exchange.sol</i>) пов'язаний з одним токеном ERC20 і містить пул ліквідності як ETH, так і цього токена. Обмінний курс між ETH і ERC20 базується на відносних розмірах їх пулів ліквідності в рамках контракту. Це відбувається шляхом підтримки співвідношення \(\text{eth_pool} \times \text{token_pool} = інваріант\). Цей інваріант залишається незмінним під час торгів і змінюється тільки тоді, коли ліквідність додається або видаляється з ринку.</p>
          <p>Спрощена версія <b>ethToTokenSwap()</b>, функції для конвертації ETH в токени ERC20, показана нижче:</p>
          <div class="iframe_center">
            <iframe src="https://ethfiddle.com/services/iframesnippet/mYAUfXQukZ" scrolling="no" frameborder="0" height="280" width="300" style="width: 50%;"></iframe>
          </div>
          <p>Обмін eth на токени означає надсилання деякої кількості eth (що зберігаються у змінній <b>msg.value</b>) у функцію смарт-контракту й отримання токенів натомість. При цьому потрібно відняти <b>msg.value</b> від балансу смарт-контракту, оскільки до моменту виклику функції надіслані eth вже були додані до його балансу.</p>
          <p>Іншою важливою змінною тут є <b>minTokens</b> - це мінімальна кількість токенів, яку користувач хоче отримати в обмін на свої eth. Ця сума розраховується в призначеному для користувача інтерфейсі і завжди містить допуск на прослизання; користувач погоджується отримати як мінімум стільки, але не менше.</p>
          <div class="iframe_center">
            <iframe src="https://ethfiddle.com/services/iframesnippet/nr7wpzj4yf" scrolling="no" frameborder="0" height="330" width="330" style="width: 60%;"></iframe>
          </div>
          <p>Це дуже важливий механізм, який захищає користувачів від підставних ботів, які намагаються перехопити їхні транзакції та змінити баланс пулу у своїх інтересах.</p>
          <p>Тепер маючи цю функцію, можна написати реалізацію для функцій розрахунку курсу обміну для ERC20 – ETH і ETH – ER20:</p>
          <div class="iframe_center">
            <iframe src="https://ethfiddle.com/services/iframesnippet/42edjbfuiw" scrolling="no" frameborder="0" height="417" width="300" style="width: 45%;"></iframe>
          </div>

          <h3>Обмін ERC20 ⇄ ERC20</h3>
          <p>Оскільки ETH використовується як загальна пара для всіх токенів ERC20, його можна використовувати як посередника для прямого обміну ERC20 на ERC20. Наприклад, можна конвертувати з OMG в ETH на одній біржі, а потім з ETH в KNC на іншій в рамках однієї транзакції.</p>
          <div class="iframe_center">
            <iframe src="https://ethfiddle.com/services/iframesnippet/zHP2xFtYrl" scrolling="no" frameborder="0" height="360" width="300" style="width: 60%;"></iframe>
          </div>
          <p>Для конвертації з <i>OMG</i> в <i>KNC</i>, наприклад, покупець викликає функцію <b>tokenToTokenSwap()</b> на біржовому контракті <i>OMG</i>.</p>
          <p>де <b>tokenAddress</b> - адреса токена KNC, а <b>tokensSold</b> - кількість проданих OMG. Ця функція спочатку перевіряє фабрику, щоб отримати адресу біржі KNC. Потім біржа конвертує вхідний OMG в ETH. Однак замість того, щоб повернути покупцеві придбаний ETH, функція викликає функцію оплати <b>ethToTokenTransfer()</b> на біржі KNC:</p>
          <div class="iframe_center">
            <iframe src="https://ethfiddle.com/services/iframesnippet/CiEzRB4fL3" scrolling="no" frameborder="0" height="230" width="300" style="width: 68%;"></iframe>
          </div>
          <p><b>ethToTokenTransfer()</b> отримує ETH і адресу покупця, перевіряє, що виклик зроблено з біржі в реєстрі, конвертує ETH в KNC і пересилає KNC початковому покупцеві. Ця функція працює так само, як і <b>ethToTokenSwap()</b>, але має додатковий вхідний параметр <b>recipient: address</b>. Він використовується для пересилання придбаних токенів початковому покупцеві замість <b>msg.sender</b>, яким в даному випадку буде біржа OMG.</p>

          <h3>Забезпечення ліквідності</h3>
          <h4>Додавання ліквідності</h4>
          <p>Додавання ліквідності вимагає внесення еквівалентної вартості токенів ETH і ERC20 у відповідний контракт на обмін токена ERC20.</p>
          <p>Перший постачальник ліквідності, який приєднався до пулу, встановлює початковий обмінний курс, вносячи еквівалентну, на його думку, вартість токенів ETH і ERC20. Якщо це співвідношення не відповідає дійсності, арбітражні трейдери приведуть ціни до рівноваги за рахунок початкового постачальника ліквідності.</p>
          <p>Всі наступні постачальники ліквідності депонують ETH і ERC20 за курсом на момент депонування. Якщо обмінний курс поганий, існує можливість вигідного арбітражу, який скоригує ціну.</p>

          <h4>Токени ліквідності</h4>
          <p><b>Токени ліквідності</b> - це внесок постачальників ліквідності в пару ETH - ERC20. Вони самі є токенами ERC20 і включають в себе повну реалізацію <a href="https://github.com/ethereum/ercs/blob/master/ERCS/erc-20.md">EIP-20</a></p>
          <p>Це дозволяє постачальникам ліквідності продавати свої токени ліквідності або переказувати їх між рахунками, не вилучаючи ліквідність з пулів. Токени ліквідності є специфічними для однієї біржі ETH ⇄ ERC20. Для цього проекту не існує єдиного, об'єднуючого токена ERC20.</p>
          <div class="iframe_center">
            <iframe src="https://ethfiddle.com/services/iframesnippet/A38GXaOUTI" scrolling="no" frameborder="0" height="750" width="300" style="width: 50%;"></iframe>
          </div>
          <p>Кількість випущених токенів ліквідності визначається кількістю ETH, відправлених на функцію.</p>
          <p>Провайдери ліквідності викликають функцію <b>addLiquidity()</b>, щоб поповнити резерви і випустити нові токени ліквідності.</p>

          <h4>Видалення ліквідності</h4>
          <p>Постачальники можуть спалити свої токени ліквідності в будь-який час, щоб вилучити свою пропорційну частку токенів ETH і ERC20 з пулів.</p>
          <p>Токени ETH і ERC20 виводяться за поточним обмінним курсом (резервним коефіцієнтом), а не за коефіцієнтом початкової інвестиції. Це означає, що частина вартості може бути втрачена через ринкові коливання та арбітраж.</p>
          <p>Комісії, отримані під час торгів, додаються до загального пулу ліквідності без карбування нових токенів ліквідності. Тому <b>ethWithdrawn</b> і <b>tokensWithdrawn</b> включають пропорційну частку всіх комісій, зібраних з моменту першого додавання ліквідності.</p>

          <h4>Структура зборів</h4>
          <p>За обмін між токенами ETH і ERC20 стягується комісія в розмірі <b>1%</b>. Ця комісія розподіляється між постачальниками ліквідності пропорційно їх внеску в резерви ліквідності. Оскільки операції з обміну ERC20 на ERC20 включають в себе як обмін ERC20 на ETH, так і обмін ETH на ERC20, комісія сплачується на обох біржах. Плата за платформу не стягується.</p>
          <p>Комісія за своп негайно депонується в резерви ліквідності. Оскільки загальні резерви збільшуються без додавання додаткових токенів, це збільшує вартість всіх токенів в рівній мірі. Це функціонує як виплата постачальникам ліквідності, яку можна отримати, спалюючи токени.</p>
          <p>Оскільки комісійні додаються до пулів ліквідності, інваріант збільшується в кінці кожної транзакції. В рамках однієї транзакції інваріант являє собою \(\text{eth_pool} \times \text{token_pool}\) на кінець попередньої транзакції.</p>
          <p>Ще одним елементом функціоналу моє децентралізованої платформи для обміну криптоактивів став дефляційний механізм у вигляді аукціону.</p>
          <p>Механізм дефляції на децентралізованих біржах часто використовується для стимулювання володіння токенами та зниження загального постачання. Його ціль полягає у зменшенні кількості доступних токенів на ринку з плином часу.</p>
          <p>Один з можливих механізмів дефляції - це "захоплення та спалювання" (<a href="https://medium.com/@playmakr/the-buyback-and-burn-model-a-deep-dive-into-its-pros-and-cons-in-web3-ecosystems-8b7f94acf2e3">buyback and burn</a>) токенів. В рамках цього механізму, проект або біржа регулярно придбає власні токени зі збору комісій або прибутку і спалює їх, тобто вилучає назавжди з обігу. Це призводить до зменшення загального постачання токенів, що зазвичай призводить до зростання їхньої вартості.</p>
          <p>Один із таких механізмів має такий сценарій: децентралізована біржа запускає лотерейний протокол, де учасники можуть придбати лотерейні квитки за вартість у токенах. Потім, зібравши достатню кількість квитків, біржа випадковим чином вибирає переможців, які отримують призи у вигляді токенів. Часто в таких лотереях використовуються механізми, які дозволяють викупити квитки за додаткові знижки або бонуси. Цей процес сприяє залученню нових учасників, збільшенню попиту на токени та їхній вартості.</p>
          <p>Ці механізми стимулюють володіння токенами, активізують ринок та можуть мати позитивний вплив на ціну токенів. Проте, варто розуміти, що кожен проект може мати власні механізми дефляції, і вони можуть відрізнятися в залежності від специфіки проекту та його цілей.</p>
          <p>В своїй роботі я також вирішив реалізувати механізм дефляції. На відмінну від лотереї, в мене механізм буде працювати за принципом англійського аукціону. Тобто користувачі можуть робити ставки протягом якогось часу, кожна ставка повинна бути більшою ніж попередня, після закінчення часу всі токени які були поставлені спалюються, далі вибирається переможець – це буде той хто поставив найбільшу ставку і йому нараховується нагорода. Нагорода завжди фіксована і по замовчуванню вона дорівнює 5000 токенів проекту.</p>
          <p>Механізм націлений на те, що сума всіх ставок буде більшою за нагороду, в інакшому випадку він навпаки буде інфляційним. Названий він був Cottery від слів Caramel(символ біржі) та lottery(не дивлячись на те що в моїй реалізації аукціон, а не лотерея - придумати нормальну назву з Caramel + auction не вийшло🤷‍♂️).</p>
          <p>Принцип функціонування в деяких моментах схожий на реалізацію АММ. Тобто також є контракт фабрики, в якого є метод для деплою контракту аукціона.</p>
          <div class="iframe_center">
            <iframe src="https://ethfiddle.com/services/iframesnippet/7PTm3betUA" scrolling="no" frameborder="0" height="160" width="300" style="width: 40%;"></iframe>
          </div>
          <p>По реалізації функції можна побачити, що в ній присутній модифікатор <b>onlyOwner</b>, він означає що тільки власник контракту фабрики(тобто той хто завантажив його в блокчейн) може викликати цю функцію. Це зроблено для того, щоб будь хто не міг створювати власні аукціони. Це буде робитись автоматично від лиця біржі, кожних 5 хвилин(або якийсь інший час, якщо налаштування змінені).</p>
          <p>Далі йде реалізація механізмів аукціону в самому смарт-контракті <b>Cottery</b>. Там є декілька основних функцій, це: <b>placeBid</b> – розмістити ставку, та <b>endAuction</b> – завершити аукціон. При цьому, першу функцію може викликати будь який користувач, але завершити аукціон може тільки його власник.</p>
          <div class="iframe_center">
            <iframe src="https://ethfiddle.com/services/iframesnippet/a9DDuP_VUf" scrolling="no" frameborder="0" height="300" width="300" style="width: 50%;"></iframe>
          </div>
          <p>Функція працює за простим механізмом, спочатку йдуть перевірки на коректність вказаних даних, після чого якщо перевірки пройшли успішно йде переказ токенів з адреси користувача на адресу контракту. І в кінці контракт записує нові дані про користувача який розмістив найбільшу ставку. Якщо більш ніхто не переб’є його ставку, він стане переможцем.</p>
          <div class="iframe_center">
            <iframe src="https://ethfiddle.com/services/iframesnippet/M4pB-xaRr8" scrolling="no" frameborder="0" height="280" width="300" style="width: 40%;"></iframe>
          </div>
          <p>В реалізація даної функції, можна також побачити модифікатор <b>onlyOwner</b>, означаючий що тільки власник цього контракту(тобто той самий власник що і власник контракту фабрики) може завершити цей аукціон. Тобто сам аукціон не закінчується по завершенню певного часу. На фронтенді реалізований механіз таймеру, який через певний час викличе функцію <b>endAuction</b> для завершення. Що звичайно з точки зору безпеки можливо не є самим хорошим варіантом, але при цьому є самим простим, для того щоб продемонструвати механізм дефляції.</p>
          <blockquote>
            <p><i>P.S. Важливо зазначити що такий механізм(аукціону) був реалізований в цілях демонстрації та розширення функціоналу мого проекту. Він має багато недоліків, як наприклад: напередвизначеність переможця в кінці аукціону. Тобто користувач який поставив найбільшу ставку на момент закінчення аукціону, завжди забирає приз. Це дозволяє користувачам з великими балансами(китам) постійно вигравати, тобто ще збільшувати за рахунок цього свій баланс все більше і більше, оскільки не буде нікого хто би міг кункурувати з ними в розмірі ставок. 
              Краще б в цьому випадку було реалізувати механізм шансу на перемогу який був би(наприклад) прямопропорційний відсотку вкладених коштів. Тобто якщо сума всіх ставок конкретного користувача дорівнює 70% від загального розміру пулу всіх ставок для цього аукціону, то шанс що він забере приз буде дорівнювати також 70%. При такому варіанті, користувачі з великими балансами все одно будуть домінувати, але при цьому їхня перемога тепер буде хоча б не однозначно визначеною, оскільки є не 0% шанс(звичайно в випадку коли в аукціоні бере участь більше 1 користувача), що виграє хтось інший, навіть якщо сума його ставок була меншою.
              Ще одним недоліком цієї реалізації аукціону є варіант, коли пул всіх ставок буде меншим за винагороду. В такому випадку дефляційний механізм перетворюється на інфляційний, оскільки створено нових токенів буде більше ніж спалено.</i></p>
          </blockquote>

          <h2>Розробка та опис інтерфейсу користувача</h2>
          <p>Веб інтерфейс розроблявся за допомогою таких технологій як HTML, CSS та фреймворку ReactJS. На сайті знаходяться декілька головних компонентів. Елемент Header в якому знаходиться назва та логотип платформи, кнопки для переключення між різними функціональними частинами сайту, наприклад там є такі вкладки: Swap, Pool та Cottery. Також в Header пише курс відносно ефіра до власного токена біржі, там знаходиться інформація про те, на якому блокчейні працює дана платформа(в майбутньому можна реалізувати підтримку інших блокчейнів) і кнопка для підключення криптогаманця.</p>
          <p>Коли користувач заходить на сайт, йому відображається головна сторінка. По замовчуванню головною сторінкою являється сторінка Swap.</p>
          <img src="https://www.dropbox.com/scl/fi/ya5ijoygptg7y6eq04ia9/blockchain-2024-06-04_17.png?rlkey=usj87q1q74wrjxx0glaz8q85i&dl=1" class="one_picture"></img>
          <p class="one_caption">Рис. 17 Головна сторінка сайту</p>
          <p>В основній частині сторінки знаходиться вікно для обміну токенів. Зверху вікна можна побачити дві кнопки для обміну ERC20 ↔ ERC20 та ERC20 ↔ ETH відповідно.</p>
          <p>Натиснувши на відповідний елемент(з білою стрілкою вниз) користувачу відобразиться модальне вікно де він із списку токенів може вибрати той який йому необхідний.</p>
          <img src="https://www.dropbox.com/scl/fi/z71cpdeabhcousy98yfr2/blockchain-2024-06-04_18.png?rlkey=z6et4g3r7ascke1t4dqumo9i1&dl=1" class="one_picture"></img>
          <p class="one_caption">Рис. 18 Модальне вікно для вибору токенів</p>
          <p>В цьому вікні відображається як назва токену так і адрес його контракту. Це потрібно для того, щоб розрізняти токени в яких однакова назва.</p>
          <p>Вибравши два токени, та ввівши необхідну кількість для обміну відображається наступна інформація:</p>
          <ol>
            <li>Баланс токенів на гаманці. Знаходиться біля меню для вибора токенів.</li>
            <li>Ввівши кількість токенів в одне із полів, в іншому виведеться відповідна кількість іншого токену, який користувач отримає за обмін по зазначеному курсу.</li>
            <li>Над кнопкою для обміну, сірим текстом зображена інформація про курс відносно цих токенів, так кількість ліквідності в пулі.</li>
          </ol>
          <img src="https://www.dropbox.com/scl/fi/jjwtfgaxbu65t1ug9v98o/blockchain-2024-06-04_19.png?rlkey=tgwash1swit36c0eyt8xy7lqc&dl=1" class="one_picture"></img>
          <p class="one_caption">Рис. 19 Вікно з для обміну токенів на токени за введеними данними</p>
          <p>Якщо натиснути на кнопку Token ↔ ETH, відобразиться таке саме вікно, тільки там можна буде обміняти виключно токен на ефір або навпаки. Можна побачити що в другому полі для введення немає білої стрілки, це тому що це поле фіксоване і в ньому завжди буде знаходитись ефір, натомість в першому модальному вікні вибора, можна вибрати той токен який буде обмінюватись і навпаки(в залежності від того в якому полі користувач введе дані).</p>
          <img src="https://www.dropbox.com/scl/fi/ca8hhczgi0b2qh7sbx67n/blockchain-2024-06-04_20.png?rlkey=xbf6d998x59crnf2kmsfggnod&dl=1" class="one_picture"></img>
          <p class="one_caption">Рис. 20 Вікно з для обміну токенів на ефір за введеними данними</p>
          <p>На сторінці Pool глобально інтерфейс не сильно змінюється. По центру знаходиться таке ж саме вікно, тільки там вже три кнопки для вибору: Add, Remove і Create. Відповідно для додавання ліквідності, вилучення та створення нового контракту обміну для нового токена.</p>
          <img src="https://www.dropbox.com/scl/fi/mcxzn3snzukuoech2uh4d/blockchain-2024-06-04_21.png?rlkey=a0fm5vlo3w73fc8ohbgmuztaz&dl=1" class="one_picture"></img>
          <p class="one_caption">Рис. 21 Сторінка Pool, вікно для створення нового контракту обміну для введеного адресу</p>
          <img src="https://www.dropbox.com/scl/fi/1uc1o1yy0eoglk8ym2j67/blockchain-2024-06-04_22.png?rlkey=gtulif3grldw2p4s3ptqqt9ac&dl=1" class="one_picture"></img>
          <p class="one_caption">Рис. 22 Сторінка Pool, вікно для додавання ліквідності за введеними данними</p>
          <p>Можна побачити що в даному пулі ліквідності, вже знаходяться якісь активи, тому користувач коли хоче додати ще своїх активів в цей пул, не може це зробити довільним чином. Пул сам розраховує в якому відношенні треба додати токени та ефір. Якби в цьому пулі ще не було ліквідності, то тоді користувач міг би додати довільну кількість першого та другого активів.</p>
          <img src="https://www.dropbox.com/scl/fi/4z9t4arls13iw2orvckxk/blockchain-2024-06-04_23.png?rlkey=dkrknqejpwz385ahpi1154p62&dl=1" class="one_picture"></img>
          <p class="one_caption">Рис. 23 Сторінка Pool, вікно для вилучення ліквідності за введеними данними</p>
          <p>Основне на що потрібно звернути увагу на рис. 23 це те що токену GLX була введена така сама кількість як і на рис. 22, але якщо при додаванні ліквідності, користувачу при 50 токенах GLX треба було відправити ще 37.5 ETH, то при вилученні ліквідності користувач за 50 токенів GLX отримає 38 ETH. Це відбувається по тій причині, що в парі з токеном GLX вже відбувались якісь торги, і комісія за ці торги відправлялась в відповідний пул ліквідності. Оскільки всі провайдери ліквідності отримують частку від всіх комісій, вилучених при торгівлі їхнім активом, то відповідно при вулечнні ліквідності, провайдер отримує трохи більше ніж додав.</p>
          <p>На сторінці Cottery можна побачити вікно аукціону. В поле для введення, користувачі будуть вводити розміри ставок які вони хочуть розмістити.</p>
          <img src="https://www.dropbox.com/scl/fi/t86o7g1cboehbdtl1xy12/blockchain-2024-06-04_24.png?rlkey=1h9xcbtenisqruwvxfq9tgrtc&dl=1" class="one_picture"></img>
          <p class="one_caption">Рис. 24 Сторінка Cottery, вікно початку аукціону</p>
          <p>Також трохи нижче відображається інформація про найвищу ставку, про загальну нагороду, та суму всіх ставок. Ще трохи нижче відображається таймер, який інформує коли почнеться новий аукціон. За допомогою кнопки “Bid caramel” можна зробити ставку в токенах CRML.</p>
          <img src="https://www.dropbox.com/scl/fi/ts3zpsohu7q3wlt3qv87k/blockchain-2024-06-04_25.png?rlkey=ihitfbhj5k525t6kalep00pf6&dl=1" class="one_picture"></img>
          <p class="one_caption">Рис. 25 Сторінка Cottery, вікно розпочатого аукціону</p>
          <p>На рис. 25 можна побачити, що аукціон вже розпочатий, та завершиться він через 4 хв. 17 сек. Найбільша ставка на даний момент 200 токенів CRML, загальний призовий пул 5000 CRML а загальна сума ставок сягає 250 CRML.</p>
          <p>Отже якщо більше ставок не буде, то аукціон завершиться з такими даними. Виграє користувач який поставив 200 токенів, 250 токенів буде спалено, натомість переможець отримає 5000 токенів. В даному випадку дефляційний механізм став інфляційним.</p>

          <h2>Інструкції користувачу</h2>
          <p>Для запуску проекту потрібно встановити наступні програмні інструменти:</p>
          <ul>
            <li><b>Visual Studio Code:</b> Це популярний редактор коду, який надає потужні функції для редагування та налагодження коду(можна використовувати і будь-який інший редактор).</li>
            <li><b>Node.js:</b> Це виконавче середовище JavaScript, яке дозволяє виконувати JavaScript-код на сервері.</li>
            <li><b>Solidity:</b> Це мова програмування, спеціально призначена для розробки смарт-контрактів на платформі Ethereum(для роботи з нею можна встановити Hardhat).</li>
            <li><b>React:</b> Це популярний JavaScript-фреймворк для розробки користувацького інтерфейсу.</li>
            <li><b>Ganache:</b> Це локальна блокчейн-мережа, яка використовується для розробки та тестування смарт-контрактів.</li>
            <li><b>Google Chrome:</b> Це веб-браузер, який використовується для перегляду та тестування веб-додатків.</li>
            <li><b>Metamask:</b> Це розширення браузера, яке дозволяє користувачам взаємодіяти з децентралізованими додатками на блокчейні Ethereum.</li>
            <li><b>Ethers.js:</b> Це JavaScript-бібліотека, яка надає зручний спосіб взаємодії з блокчейном Ethereum.</li>
            <li><b>Hardhat:</b> Це фреймворк для розробки смарт-контрактів на платформі Ethereum.</li>
          </ul>
          <img src="https://www.dropbox.com/scl/fi/6b2p03e1nn0btgacvrz94/blockchain-2024-06-04_26.png?rlkey=xdjexvirprxlp9s8i6e0idmrf&dl=1" width="1000" class="one_picture"></img>
          <p class="one_caption">Рис. 26 Використані технології</p>
          <p>Маючи встановлені всі необхідні програмні інструменти, наступним що потрібно зробити це скачати проект з GitHub та розпакувати його в себе на локальній машині.</p>
          <p>Наступним кроком для запуску проекту, користувачеві потрібно виконати ряд дій:</p>
          <ol>
            <li>Відкрити проект в редакторі коду.</li>
            <li>Встановити всі необхідні залежності через пакетний менеджер <b>node.js npm</b>.</li>
            <li>Запустити локальний блокчейн <b>Ganache</b>.</li>
            <li>В файлі <b>.env</b> вказати необхідні змінні. Тобто приватний ключ до адресу в мережі Ethereum від лиця якого будуть розгортатись смарт-контракти, а також адрес <b>localhost</b>.</li>
            <img src="https://www.dropbox.com/scl/fi/yein5uz82vy2i7vxm9w51/blockchain-2024-06-04_27.png?rlkey=84cu89ifdkaakfdi062ssghrf&dl=1" class="one_picture"></img>
            <p class="one_caption">Рис. 27 Приклад .env файлу</p>
            <li>Зробити необхідні налаштування в файлі <b>hardhat.config.js</b>. Вони потрібні для правильної роботи інструменту <b>Hardhat</b>, тобто для розгортання смарт-контрактів в вибрану мережу блокчейну а також для тестування.</li>
            <li>Далі із директорії <b>scripts</b> потрібно запустити файл <b>deploy.js</b> який відповідає за розгортання контрактів в блокчейн. Це можна зробити за допомогою команди: <b>npx hardhat run .\scripts\deploy.js –network localganache</b>, де потрібно вказати шлях знаходження файлу <b>deploy.js</b> а також назву мережі локального блокчейну(він був вказаний в файлі <b>hardhat.config.js</b>).</li>
            <li>Наступним кроком потрібно зайти в директорію <b>src/components</b> та в файлі <b>deployedContractsAddresses.json</b> в поле <b>deploymentPrivateKey</b> вказати той самий адрес, який вказували в файлі <b>.env</b>.</li>
            <img src="https://www.dropbox.com/scl/fi/5olhsvr0g8lus5univhe8/blockchain-2024-06-04_28.png?rlkey=aom142dq98s1l5o2750hsxaye&dl=1" class="one_picture"></img>
            <p class="one_caption">Рис. 28 Приблизний вигляд файлу deployedContractsAddresses.json</p>
            <li>Після цього потрібно в терміналі ввести команду <b>npm start</b> для запуску самого проекта.</li>
            <li>Після відкриття веб-сторінки в браузері на локальному хості, користувачеві спочатку потрібно підключитись своїм криптогаманцем <b>Metamask</b> до біржі, а вже потім нею можна буде користуватись.</li>
          </ol>
          <p>На цьому всі необхідні процедури для налаштування та запуску завершені, і тепер можна вільно користуватись програмним продуктом.</p>
          <p><a href="https://github.com/sh3ifu/Decentralized-Exchange">GitHub репозиторій з проектом</a></p>
          <p><a href="https://www.youtube.com/watch?v=_w87HMNmPAA">Відеоогляд</a></p>
        </div>
    </div>    
</body>
</html>